#!/bin/bash

# Define the save path
DIR="$HOME/Pictures"
FILENAME="$DIR/$(date +'%Y%m%d_%H%M%S').png"

# Ensure directory exists
mkdir -p "$DIR"

if [ "$1" = "active" ]; then
    # Get active window coordinates using jq
    GEOM=$(hyprctl activewindow -j | jq -r '"\(.at[0]),\(.at[1]) \(.size[0])x\(.size[1])"')
    
    # Take shot, save to file, copy to clipboard
    grim -g "$GEOM" - | tee "$FILENAME" | wl-copy -t image/png
    
    # Send notification for Active Window
    notify-send "Active Window Captured" "Saved to $DIR" -i "$FILENAME"

elif [ "$1" = "area" ]; then
    # Use slurp for area selection
    # We capture the geometry first to handle cancellation (pressing Esc) gracefully
    GEOM=$(slurp)
    
    # Only proceed if slurp didn't fail (user didn't press Esc)
    if [ -n "$GEOM" ]; then
        grim -g "$GEOM" - | tee "$FILENAME" | wl-copy -t image/png
        
        # Send notification for Area Selection
        notify-send "Area Selection Captured" "Saved to $DIR" -i "$FILENAME"
    fi
fi
